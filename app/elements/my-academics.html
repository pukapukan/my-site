<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="my-font-awesome.html">

<polymer-element name="my-academics" attributes="onScroll">
  <template>
    <link href="/elements/my-academics.css" rel="stylesheet">
    <div class="page" id="master">
      <div class="floater">
        <img class="logo" src="/images/academic/uoa.gif" />
        <div class="title">Master of Engineering</div>
        <div class="specialisation">Software Engineering</div>
        <div class="period">2008 ~ 2009</div>
        <div></div>
      </div>

      <div class="rolling-text">
        <div>Research topic focused on applying software engineering principles to IEC61499 Function Block - an open standard for distributed control and automation targetted for industrial automation.</div>
        <div></div>
      </div>
    </div>
    <div class="page" id="page2">
      <div class="floater">
        Section 2
        <div class="image-placeholder red">2nd Image</div>
        <div class="right">
          <div>University of Auckland</div>
          <div>Master of Engineering (Hons.)</div>
          <div>Software engineering in industrial automation field of IEC61499</div>
          <div class="text">2008~2009</div>
        </div>
      </div>

      <div class="rolling-text">
        Some random text that scrolls for page 2
      </div>
    </div>

    <div class="page" id="page3">
      <div class="floater">
        Section 3
        <div class="image-placeholder red">2nd Image</div>
        <div class="right">
          <div>University of Auckland</div>
          <div>Master of Engineering (Hons.)</div>
          <div>Software engineering in industrial automation field of IEC61499</div>
          <div class="text">2008~2009</div>
        </div>
      </div>

      <div class="rolling-text">
        Some random text that scrolls for page 3
      </div>
    </div>

    <div class="page" id="page4">
      <div class="floater">
        Section 4
        <div class="image-placeholder">2nd Image</div>
        <div class="right">
          <div>University of Auckland</div>
          <div>Master of Engineering (Hons.)</div>
          <div>Software engineering in industrial automation field of IEC61499</div>
          <div class="text">2008~2009</div>
        </div>
      </div>

      <div class="rolling-text">
        Some random text that scrolls for page 4
      </div>
    </div>
  </template>
  <script>
  var pages;
  var $scroller, $academic, $academicHeader;
  var headerGap = 56;
  Polymer({
    ready: function () {
      var query = this.shadowRoot.querySelectorAll('.page');
      pages = query.array();

      var root = this.parentElement.parentElement;
      $academic = this.parentElement;
      $academicHeader = this.parentElement.querySelector('#academicHeader');
    },
    onScroll: function (event, detail, sender) {
      $scroller = $scroller || detail.target;

      var headerStyle = $academicHeader.style;
      var currentTop = $scroller.scrollTop;
      var sectionTop = $academic.offsetTop;
      var lastSectionHeight = pages[pages.length - 1].scrollHeight;
      var headerGap = 56;

      // set sticky header
      if (currentTop < sectionTop) {
        headerStyle.top = headerGap + 'px';
      } else if (currentTop >= sectionTop && currentTop <= (sectionTop + $academic.scrollHeight - lastSectionHeight) /* && currentTop <= (sectionTop + lastSectionHeight) */) {
        // if (!pages[0].classList.contains('show')) {
        //   pages[0].classList.add('show');
        // }

        headerStyle.top = (currentTop - sectionTop + headerGap) + 'px';
      }

      // add card behaviour to academic record
      var floater, floaterStyle, opacity;
      var pageTop;
      var breakNow = false;
      pages.forEach(function(page, index) {
        if (!index && currentTop >= sectionTop + page.offsetTop - screen.height) {
          if (!pages[0].classList.contains('show')) {
            pages[0].classList.add('show');
          }
        }

        if (currentTop >= sectionTop + page.offsetTop - page.scrollHeight) {
          floater = page.querySelector('.floater');
          floaterStyle = floater.style;

          if (index) {
            if (currentTop - sectionTop - page.offsetTop + page.scrollHeight/2 <=0) {
              floaterStyle.opacity = 0;
            } else {
              if (!page.classList.contains('show')) {
                page.classList.add('show');
              }
              opacity = (currentTop - sectionTop - page.offsetTop + page.scrollHeight) / page.scrollHeight;
              floaterStyle.opacity = opacity;
            }
          }

          if(currentTop <= sectionTop + $academic.scrollHeight - lastSectionHeight) {
            floaterStyle.top = Math.max(0, currentTop - sectionTop) + 250 + (index * 20) + 'px';
          }
        }
      });

    }
  });
  </script>
</polymer-element>
