<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="my-font-awesome.html">

<polymer-element name="my-academics" attributes="onScroll">
  <template>
    <link href="/elements/my-academics.css" rel="stylesheet">
    <div class="pages">
      <div class="page" id="master">
        <div class="floater">
          <div class="title">Master of Engineering</div>
          <div class="period">2008 ~ 2009</div>
          <img class="logo" src="/images/academic/uoa.gif" />
          <div class="specialisation">Software Engineering</div>
        </div>

        <div class="rolling-text">
          <div>Research topic focused on applying software engineering principles to IEC61499 Function Block - an open standard for distributed control and automation targetted for industrial automation.</div>
          <div></div>
        </div>
      </div>
      <div class="page" id="page2">
        <div class="floater">
          Section 2
          <div class="image-placeholder red">2nd Image</div>
          <div>University of Auckland</div>
          <div>Master of Engineering (Hons.)</div>
          <div>Software engineering in industrial automation field of IEC61499</div>
          <div class="text">2008~2009</div>
        </div>

        <!-- <div class="rolling-text">
          Some random text that scrolls for page 2
        </div> -->
      </div>

      <div class="page" id="page3">
        <div class="floater">
          Section 3
          <div class="image-placeholder red">2nd Image</div>
          <div class="right">
            <div>University of Auckland</div>
            <div>Master of Engineering (Hons.)</div>
            <div>Software engineering in industrial automation field of IEC61499</div>
            <div class="text">2008~2009</div>
          </div>
        </div>

        <!-- <div class="rolling-text">
          Some random text that scrolls for page 3
        </div> -->
      </div>

      <div class="page" id="page4">
        <div class="floater">
          Section 4
          <div class="image-placeholder">2nd Image</div>
          <div class="right">
            <div>University of Auckland</div>
            <div>Master of Engineering (Hons.)</div>
            <div>Software engineering in industrial automation field of IEC61499</div>
            <div class="text">2008~2009</div>
          </div>
        </div>

        <!-- <div class="rolling-text">
          Some random text that scrolls for page 4
        </div> -->
      </div>
    </div>
    <div class="cover">
      <div class="coverpage page1"></div>
      <div class="coverpage page2"></div>
      <div class="coverpage page3"></div>
      <div class="coverpage page4"></div>
    </div>
  </template>
  <script>
  // DOM elements
  var pages, pagesWrapper, covers;
  var $academic, $academicHeader;

  // constants
  var headerGap = 56;
  var floaterTopMargin = 200;

  // variables
  var lastSectionHeight, lastSectionTop, sectionTop, sectionHeight;

  // calculate variables when page load/resizes
  var recalculate = function() {
    sectionTop = $academic.offsetTop;
    lastSectionHeight = pages[pages.length - 1].scrollHeight;
    lastSectionTop = sectionTop + $academic.scrollHeight - lastSectionHeight;
    sectionHeight = pagesWrapper.scrollHeight - lastSectionHeight;
  };

  Polymer({
    domReady: function () {
      pages = this.shadowRoot.querySelectorAll('.page').array();
      pagesWrapper = this.shadowRoot.querySelector('.pages');

      covers = this.shadowRoot.querySelectorAll('.coverpage');

      $academic = this.parentElement;
      $academicHeader = this.parentElement.querySelector('#academicHeader');

      window.onresize = recalculate;
    },
    onScroll: function (event, detail, sender) {
      if (!lastSectionHeight) {
        recalculate();
      }
      sectionTop = $academic.offsetTop;
      var currentTop = detail.target.scrollTop;
      var offsetToParent = currentTop - sectionTop;

      // // set sticky header
      if(currentTop < sectionTop) {
        $academicHeader.classList.remove('sticky');
        $academicHeader.classList.remove('hide');
        // $academicHeader.style.top = (offsetToParent + headerGap) + 'px';
      } else if (currentTop >= sectionTop && currentTop <= sectionTop + sectionHeight) {
        $academicHeader.classList.add('sticky');
        $academicHeader.classList.add('hide');
      } else {
        $academicHeader.classList.add('hide');
      }

      // add card behaviour to academic record
      pages.forEach(function(page, index) {
        if (!index && !page.classList.contains('show') && currentTop >= sectionTop + page.offsetTop - screen.height) {
          page.classList.add('show');
        }

        if (currentTop >= sectionTop) {
          page.classList.add('sticky');
        } else {
          page.classList.remove('sticky');
        }

        if (currentTop >= sectionTop + page.offsetTop - page.scrollHeight) {
          // floaterStyle = page.querySelector('.floater').style;

          if (index && offsetToParent - page.offsetTop + page.scrollHeight/2 <= 0) {
            // page.querySelector('.floater').style.opacity = 0;
            page.classList.remove('show');
            covers[index].classList.remove('show');
          } else {
            page.classList.add('show');
            covers[index].classList.add('show');
            // page.querySelector('.floater').style.opacity = (offsetToParent - page.offsetTop + page.scrollHeight) / page.scrollHeight;
          }


          if(currentTop <= sectionTop + sectionHeight) {
            // floaterStyle.top = Math.max(0, Math.min(currentTop, sectionTop + sectionHeight) - sectionTop) + floaterTopMargin + (index * 75) + 'px';
          }
        }
      });

    }
  });
  </script>
</polymer-element>
